<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/styles/style.css">
    <title>Название продукта</title>
</head>

<body>
    <header>
        <div class="navigator">
            <a href="/" style="display: contents;"><img src="static/img/gui/logo.svg"></a>
            <button id="nav_adaptiv" class="nav_adaptiv" onclick="adaptivMenu()"><img src="static/img/gui/Catalog.svg"></button>
            <nav class="hide">
                <span>
                    <img src="static/img/gui/home.svg">
                    <a href="/">Главная</a>
                </span>
                <span>
                    <img src="static/img/gui/Catalog.svg">
                    <a href="catalog">Каталог</a>
                </span>
                <span>
                    <img scr="static/img/gui/Search.svg">
                    <a href="index">Поиск</a>
                </span>
                <span>
                    <img src="static/img/gui/favourite.svg">
                    <a href="favourites">Избранное ({{ favs_len }})</a>
                </span>
                <span>
                    <img src="static/img/gui/backets.svg">
                    <a href="basket">Корзина ({{ basket_len }})</a>
                </span>
                <span>
                    <img src="static/img/gui/Profile.svg">
                    <a href="profile">Профиль</a>
                </span>
            </nav>
        </div>
    </header>
    <main>
        <h1>Витрина</h1>
    </main>

    <h2>{{ item.title }}</h2>
    <span style="width:100%;">
        <div class="product">
            <span style="width:70%">
                <img src="static/img/gui/star.svg" alt="">
                <img src="static/img/gui/star.svg" alt="">
                <img src="static/img/gui/star.svg" alt="">
                <img src="static/img/gui/star.svg" alt="">
                <img src="static/img/gui/star.svg" alt="">
                <p>4.8</p>
                <a href="#" style="margin-top:2%;">{{ item.comments|length }} отзыва(ов)</a>

                <script src="//ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
                <script type=text/javascript>
                    const urlParams = new URLSearchParams(window.location.search);
                    $(function() {
                        var box = $('div#favBox');
                        $.fn.sendFav = function(method, correctText, incorrectText, newLabel) {
                            $.ajax({
                                url: "{{ url_for('set_remove_fav') }}",
                                method: "POST",
                                data: method+urlParams.get('id'),
                                contentType: 'application/json;charset=UTF-8',
                                success: function(data) {
                                    if (data == "not auth")
                                        alert("Вы не авторизированы"); // TODO: Изменить
                                    else if (data == "incorrect")
                                        alert(incorrectText); // TODO: Изменить
                                    else {
                                        alert(correctText); // TODO: Изменить
                                        box.children('label').text(newLabel);
                                    }
                                }
                            });
                        };
                        box.children('input').on('change', function() {
                            if ($(this).is(':checked'))
                                $.fn.sendFav("set:",
                                    "Предмет добавлен в избранное",
                                    "Не удалось добавить предмет в избранное",
                                    "Убрать из избранного"
                                );
                            else
                                $.fn.sendFav("rem:",
                                    "Предмет убран из избранного",
                                    "Не удалось убрать предмет из избранное",
                                    "Добавить в избранное"
                                );
                        })
                    });
                </script>

                <div id="favBox">
                    {% if in_fav %}
                        <input type="checkbox" id="fav" checked>
                        <img src="static/img/gui/favourite.svg"><label for="fav">Убрать из избранного</label>
                    {% else %}
                        <input type="checkbox" id="fav">
                        <img src="static/img/gui/favourite.svg"><label for="fav">Добавить в избранное</label>
                    {% endif %}
                </div>
            </span>

            <span style="width:35%;margin-left:15%;">
                <div class="additional">
                    {% for image in item.images[1:] %}
                    <img src="/static/img/items/{{ image }}" width="100" height="108">
                    {% endfor %}
                </div>
                <img src="/static/img/items/{{ item.images.0 }}" width="300" height="333">
            </span>
        </div>
        <aside>
            <div class="choose_color">
                <h3>Цвет:{% for color in item.colors %}{{ color }}{% endfor %}</h3>
                <span>
                    <a style="background:blue;color:blue">aaaa</a>
                    <a style="background:rgba(57, 158, 21, 1);color:rgba(57, 158, 21, 1)">aaaa</a>
                    <a style="background:rgba(194, 94, 62, 1);color:rgba(194, 94, 62, 1)">aaaa</a>
                    <a style="background:rgba(62, 194, 115, 1);color:rgba(62, 194, 115, 1)">aaaa</a>
                </span>
                <div class="quantity">
                    <h3>Количество</h3>
                    <div class="quantity_inner">
                        <button class="bt_minus">-</button>
                        <input type="text" class="quantity" value="1" data-max-count="20">
                        <button class="bt_plus">+</button>
                    </div>
                    <div class="characteristic">
                        <b>
                            <h3>Характеристика</h3>
                        </b>
                        <h4>Размер - - - - - 40см</h4>
                        <h4>Век - - - - - - - -XX</h4>
                        <h4>Lorem - - - - - lpsum</h4>
                        <h4>Dolor - - - - - - Sit</h4>
                        <h4>Amet - - - - - -lpsum</h4>
                    </div>
                </div>
            </div>

            <div class="price">
                <p>{{ item.price }} ₽</p>

                <button>
                    <a href="#"><img src="static/img/gui/telega_small.svg">В корзину</a>
                </button>
                <p><button><a href="#">Быстрый заказ</a></button></p>
            </div>
        </aside>
    </span>

    <div class="description">
        <h2><b>Описание</b></h2>
        <h4>{{ item.description }}</h4>
    </div>
    <span>
        <aside style="width:50%">
            <div class="reviews">
                <h2>Отзывы({{ item.comments|length }})</h2>

                {% for comment in item.comments %}
                    <span>
                        <button width="300"><a href="#"><img src="static/img/gui/bukva k v krujke"></a></button>
                        <h4>{{ comment.user.name }} {{ comment.user.surname }}</h4>
                        <h5>{{ comment.date }}</h5>

                        {% for _ in range(comment.score) %}
                            <img src="static/img/gui/star.svg" alt="">
                        {% endfor %}

                    </span>

                    {% if comment.pros %}
                        <h4><b>Преимущества</b></h4>
                        <h5>{{ comment.pros }}</h5>
                    {% endif %}
                    
                    {% if comment.cons %}
                        <h4><b>Недостатки</b></h4>
                        <h5>{{ comment.cons }}</h5>
                    {% endif %}

                    {% if comment.text %}
                        <h4><b>Комментарий</b></h4>
                        <h5>{{ comment.text }} </h5>
                    {% endif %}
                    
                {% endfor %}

            </div>
        </aside>

        <div class="catalog">
            <span>
                <img src="static/img/gui/like.jpg">
                <b>4.8</b>
                <h5>основано на {{ item.comments|length }} оценке(ах)</h5>
            </span>
            <div style="width:100%">
                <span>
                    <p>5 stars
                        <hr style="width:80%;">
                        </hr>
                    </p>
                </span>
                <span>
                    <p>4 stars
                        <hr style="width:65%;">
                        </hr>
                    </p>
                </span>
                <span>
                    <p>3 stars
                        <hr style="width:50%;">
                        </hr>
                    </p>
                </span>
                <span>
                    <p>2 stars
                        <hr style="width:35%;">
                        </hr>
                    </p>
                </span>
                <span>
                    <p>1 star
                        <hr style="width:20%;">
                        </hr>
                    </p>
                </span>
            </div>
            <button><a href="#"><img src="static/img/gui/star.svg">Оставить отзыв</a></button>
        </div>
    </span>

    <footer>
        <div class="annotation">
            <img src="static/img/gui/white_logo.png">
            <p>Данный сайт разработан в исключительно учебных целях и не является действующим магазином.</p>
        </div>
        <div class="nav_footer">
            <a href="#">
                <p>О проекте</p>
            </a>
            <a href="#">
                <p>Контакты</p>
            </a>
            <a href="https://github.com/BeidinaDaria/Fiction-store.git">
                <p>GitHub</p>
            </a>
        </div>
    </footer>
 <script>
        function adaptivMenu(){
            let navig=document.querySelector("nav");
            if (navig.className=="show")
                navig.className='hide';
            else navig.className='show';
        };
    </script>
</body>

</html>
