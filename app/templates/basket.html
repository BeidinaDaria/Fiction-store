<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="static/img/gui/favicon.ico">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/styles/style.css">
    <title>Корзина</title>
</head>
<body>
    <header>
        <div class="navigator">
            <a href="/" style="display: contents;"><img src="static/img/gui/logo.svg"></a>
            <button id="nav_adaptiv" class="nav_adaptiv" onclick="adaptivMenu()"><img src="static/img/gui/Catalog.svg"></button>
            <nav class="hide">
                <span>
                    <img src="static/img/gui/home.svg">
                    <a href="/">Главная</a>
                </span>
                <span>
                    <img src="static/img/gui/Catalog.svg">
                    <a href="catalog">Каталог</a>
                </span>
                <span>
                    <img src="static/img/gui/Search.svg">
                    <a href="/#search">Поиск</a>
                </span>
                <span>
                    <img src="static/img/gui/favourite.svg">
                    <a href="favourites">Избранное ({{ favs_len }})</a>
                </span>
                <span>
                    <img src="static/img/gui/backets.svg">
                    <a href="basket">Корзина ({{ basket_len }})</a>
                </span>
                <span>
                    <img src="static/img/gui/Profile.svg">
                    <a href="profile">Профиль</a>
                </span>
            </nav>
        </div>
    </header>
    <main>
        <h1>Корзина</h1>
    </main>
    <div class="types">
        <div class="catalog">
            {% set vars = {'sum': 0} %}

            {% if basket %}

                <script src="//ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
                <script type=text/javascript>
                    function removeFromFav(id) {
                        $.ajax({
                            url: '/basket/remove',
                            type: 'POST',
                            data: id,
                            contentType: 'application/json;charset=UTF-8',
                            success: function () {
                                alert("Предмет убран из корзины"); // TODO: Изменить
                                document.getElementById('item'+id).style.display = 'none';
                                document.getElementById("count").innerHTML -= 1
                                document.getElementById("sum").innerHTML -= document.getElementById("price"+id).innerHTML
                            },
                            error: function (err) {
                                alert("Не удалось убрать предмет из корзины"); // TODO: Изменить
                                console.log(err);
                            }
                        });
                    };
                </script>

                <h2><h id="count" style="display: inline;">{{ basket|length }}</h> товара(ов) в корзине</h2>

                {% for item in basket %}

                {% if vars.update({'sum': vars['sum']+item.price}) %} {% endif %}
                <div class="item" id="item{{ item.id }}">
                    <span>
                        <img src="static/img/items/{{ item.images.0 }}" height="auto" width="25%">
                        <div class="character">
                            <span>
                                <h3 style="margin:0;">{{ item.title }}</h3>
                                <div class="price">
                                    <p><p id="price{{ item.id }}" style="display: inline;">{{ item.price }}</p>₽</p>
                                </div>
                            </span>
                            <div class="characteristic">
                                <h4>Размер - - - - - 40см</h4>
                                <h4>Век - - - - - - - -XX</h4>
                            </div>
                            <button style="background:none;border:none;" value="{{ item.id }}" onclick="removeFromFav(this.value)">
                                <img src="static/img/gui/delete.svg">
                            </button>
                        </div>
                    </span>
                </div>

                {% endfor %}

            {% endif %}

        </div>
        <aside style="background:rgba(248, 245, 245, 1);padding:10px;display:block;position:relative;" height="500px">
            <span>
                <h2>Всего: <h id="sum" style="display: inline;">{{ vars['sum'] }}</h>₽</h2>
            </span>
            <hr style="background:none;height:5px; width:100%">
            </hr>
            <span>
                <h4>Скидки: – 100₽</h4>
            </span>
            <span>
                <h4>Бонусы: – 20₽</h4>
            </span>
            <hr style="background:none;height:5px; width:100%">
            </hr>
            <span>
                <h4>Доставка: 90₽</h4>
            </span>
            <hr style="background:none;height:5px; width:100%">
            </hr>
            <span>
                <h4>Промокод</h4>
                <input type="text" method="POST" name="promo" placeholder="Промокод">
            </span>
            <button style="background:rgba(124, 103, 255, 1);border:none;border-radius:10%;padding:5px;width:90%;"><a href="#" style="color:rgba(244, 241, 255, 1);">Заказать</a></button>
        </aside>
    </div>
    <footer>
        <div class="annotation">
            <img src="static/img/gui/white_logo.png">
            <p>Данный сайт разработан в исключительно учебных целях и не является действующим магазином.</p>
        </div>
        <div class="nav_footer">
            <a href="https://github.com/BeidinaDaria/Fiction-store/blob/main/README.md">
                <p>О проекте</p>
            </a>
            <a href="https://github.com/BeidinaDaria/Fiction-store/blob/main/README.md">
                <p>Контакты</p>
            </a>
            <a href="https://github.com/BeidinaDaria/Fiction-store.git">
                <p>GitHub</p>
            </a>
        </div>
    </footer>
<script>
        function adaptivMenu(){
            let navig=document.querySelector("nav");
            if (navig.className=="show")
                navig.className='hide';
            else navig.className='show';
        };
    </script>
</body>
</html>