<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="static/img/gui/favicon.ico">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/styles/style.css">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <script>
        function showNotification(message) {
            var notification = document.querySelector('.notification');
            notification.innerHTML = message;
            notification.classList.add('show');
        }

        function hideNotification() {
            var notification = document.querySelector('.notification');
            notification.classList.remove('show');
        }

        window.onload = setTimeout(function () {
            showNotification("–ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ üõí<br>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –æ—Ç—Å—é–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
            setTimeout(function () {
                hideNotification();
            }, 10000);
        }, 100);
    </script>
</head>
<body>
<header>
    <div class="navigator">
        <a href="/" style="display: contents;"><img src="static/img/gui/logo.svg"></a>
        <button id="nav_adaptiv" class="nav_adaptiv" onclick="adaptivMenu()"><img src="static/img/gui/Catalog.svg">
        </button>
        <nav class="hide">
                <span>
                    <img src="static/img/gui/home.svg">
                    <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                </span>
            <span>
                    <img src="static/img/gui/Catalog.svg">
                    <a href="catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
                </span>
            <span>
                    <img src="static/img/gui/Search.svg">
                    <a href="/#search">–ü–æ–∏—Å–∫</a>
                </span>
            <span>
                    <img src="static/img/gui/favourite.svg">
                    <a href="favourites">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ({{ favs_len }})</a>
                </span>
            <span>
                    <img src="static/img/gui/backets.svg">
                    <a href="basket">–ö–æ—Ä–∑–∏–Ω–∞ ({{ basket_len }})</a>
                </span>
            <span>
                    <img src="static/img/gui/Profile.svg">
                    <a href="profile">–ü—Ä–æ—Ñ–∏–ª—å</a>
                </span>
        </nav>
    </div>
</header>
<main>
    <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>
</main>
<div class="types">
    <div class="catalog favcatalog">
        {% set vars = {'sum': 0} %}

        {% if not basket %}

            <h2>–í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ —á—Ç–æ-–Ω–∏–±—É–¥—å, –Ω–∞–∂–∞–≤ –Ω–∞ üõí</h2>

        {% else %}

            <script src="//ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
            <script type=text/javascript>
                function removeFromFav(id) {
                    $.ajax({
                        url: '/basket/remove',
                        type: 'POST',
                        data: id,
                        contentType: 'application/json;charset=UTF-8',
                        success: function () {
                            setTimeout(function () {
                                showNotification("–ü—Ä–µ–¥–º–µ—Ç —É–±—Ä–∞–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã üëå");
                                setTimeout(function () {
                                    hideNotification();
                                }, 4000);
                            }, 100);
                            document.getElementById('item' + id).style.display = 'none';
                            document.getElementById("count").innerHTML -= 1;
                            document.getElementById("sum").innerHTML -= document.getElementById("price" + id).innerHTML;
                        },
                        error: function (err) {
                            setTimeout(function () {
                                showNotification("–ù–µ —É–¥–∞–ª–æ—Å—å —É–±—Ä–∞—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã üôà (" + err + ")");
                                setTimeout(function () {
                                    hideNotification();
                                }, 4000);
                            }, 100);
                            console.log(err);
                        }
                    });
                };
            </script>

            <h2>
                <h id="count" style="display: inline;">{{ basket_len }}</h> —Ç–æ–≤–∞—Ä–∞(–æ–≤) –≤ –∫–æ—Ä–∑–∏–Ω–µ
            </h2>
            <div class="favgallery">

            {% for item in basket %}

                {% if vars.update({'sum': vars['sum']+item.price}) %} {% endif %}
                <div class="item card" id="item{{ item.id }}">
                    <a href="product?id={{ item.id }}">
                        <img src="/static/img/items/{{ item.images.0 }}" alt="">
                    </a>
                    <div>
                        <a href="product?id={{ item.id }}">
                            <h4>{{ item.title }}</h4>
                        </a>
                        <span class="stars">
                        <img src="static/img/gui/star.svg" alt="">
                        <img src="static/img/gui/star.svg" alt="">
                        <img src="static/img/gui/star.svg" alt="">
                        <img src="static/img/gui/star.svg" alt="">
                        <img src="static/img/gui/star.svg" alt="">
                        <p>4.8</p>
                    </span>
                        <span style="display: flex; flex-direction: row">
                        <div class="price">
                            <p id="price{{ item.id }}">{{ item.price }}</p>
                        </div>
                        <div class="icons">

                            <button value="{{ item.id }}" onclick="removeFromFav(this.value)">
                                <img src="static/img/gui/telega_small.svg" alt="">
                            </button>
                            <a> <!-- TODO: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –æ—Ç—Å—é–¥–∞ -->
                                <img src="static/img/gui/favourite_small.svg" alt="">
                            </a>
                        </div>
                    </span>
                    </div>
                </div>

            {% endfor %}

        {% endif %}

    </div>
</div>

    {% if basket %}

        <aside class="checkout">
            <span>
                <h2>–í—Å–µ–≥–æ: <h id="sum" style="display: inline;">{{ vars['sum'] }}</h>‚ÇΩ</h2>
            </span>
            <span>
                <input style="padding: 15px; width: 100%" class="textrange-field" type="text" name="promo" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
            </span>
            <span> <!-- TODO: –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω -->
                <input style="padding: 15px; width: 100%" class="textrange-field" type="email" name="email" placeholder="E-mail (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞)">
            </span>
            <span>
                <input type="submit" style="padding: 15px; width: 100%" class="itemcomm_submit" value="–ó–∞–∫–∞–∑–∞—Ç—å">
            </span>
        </aside>
    
    {% endif %}

</div>
<div class="notification">
    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–∫–Ω–∞ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<footer>
    <div class="annotation">
        <img src="static/img/gui/white_logo.png">
        <p>–î–∞–Ω–Ω—ã–π —Å–∞–π—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –º–∞–≥–∞–∑–∏–Ω–æ–º.</p>
    </div>
    <div class="nav_footer">
        <a href="https://github.com/BeidinaDaria/Fiction-store/blob/main/README.md">
            <p>–û –ø—Ä–æ–µ–∫—Ç–µ</p>
        </a>
        <a href="https://github.com/BeidinaDaria/Fiction-store/blob/main/README.md">
            <p>–ö–æ–Ω—Ç–∞–∫—Ç—ã</p>
        </a>
        <a href="https://github.com/BeidinaDaria/Fiction-store.git">
            <p>GitHub</p>
        </a>
    </div>
</footer>
<script>
    function adaptivMenu() {
        let navig = document.querySelector("nav");
        if (navig.className == "show")
            navig.className = 'hide';
        else navig.className = 'show';
    };
</script>
</body>
</html>